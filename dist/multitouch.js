var Multitouch;!function(t){var e=function(){function t(t){this.interactions={},document=t}return t.generateGuid=function(){var t=performance.now(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return e},t.prototype.init=function(){var t=this;document.addEventListener("touchstart",function(e){t.handleInteraction(e)}),document.addEventListener("touchend",function(e){t.handleInteraction(e)}),document.addEventListener("touchcancel",function(e){t.handleInteraction(e)}),document.addEventListener("touchmove",function(e){t.handleInteraction(e)}),document.addEventListener("mousedown",function(e){t.handleInteraction(e)}),document.addEventListener("mouseup",function(e){t.handleInteraction(e)}),document.addEventListener("mousemove",function(e){t.handleInteraction(e)}),document.addEventListener("click",function(e){t.handleInteraction(e)})},t.prototype.handleInteraction=function(t){if(t instanceof TouchEvent)for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a="touch-"+i.identifier,s=t.target;s.dataset.touch=(!0).toString();var o=this.interactions[a];t.type.indexOf("start")>=0?this.interactions[a]=new n(a,i.identifier,t):t.type.indexOf("cancel")>=0?this.interactions[a]=null:o&&o.update(t),o&&(o.ending=t.type.indexOf("end")>0,this.interactions[a]=o)}else if(t instanceof MouseEvent){var r="mouse",s=t.target;if(s.dataset.touch===(!0).toString())return t.type.indexOf("up")>=0&&(s.dataset.touch=(!1).toString()),t.stopImmediatePropagation(),void t.preventDefault();var o=this.interactions[r];t.type.indexOf("down")>=0?this.interactions[r]=new n(r,0,t):o&&o.update(t),o&&(o.ending=t.type.indexOf("up")>=0,this.interactions[r]=o)}this.coalesceInteractions()},t.prototype.coalesceInteractions=function(){for(var t=this.interactions,e=Object.keys(t).map(function(e){return t[e]}),n=0,i=e;n<i.length;n++){var a=i[n];if(a.updated){var s=!1;if(!s&&a.closestScaleElm){for(var o=void 0,r=0,c=e;r<c.length;r++){var u=c[r];if(a!=u&&u.closestScaleElm==a.closestScaleElm){o=u;break}}o&&(console.log("Scale event"),s=!0)}if(!s&&a.closestDragElm&&a.previousEvent&&a.currentEvent&&!a.ending){var d=a.previousEvent.position,l=a.currentEvent.position;if(d&&l){var h=l.pageX-d.pageX,v=l.pageY-d.pageY;console.log("Drag event x="+h+" y="+v),s=!0}}if(!s&&a.targetElm&&a.startEvent&&a.currentEvent&&a.ending&&a.currentEvent.time-a.startEvent.time<300){var d=a.previousEvent.position,l=a.currentEvent.position;if(d&&l){var h=l.pageX-d.pageX;h=0>h?-1*h:0;var v=l.pageY-d.pageY;v=0>v?-1*v:0,30>h&&30>v&&console.log("Click event!")}}a.ending?delete this.interactions[a.key]:s&&(this.interactions[a.key].updated=!1)}}},t}();t.Manager=e;var n=function(){function e(e,n,i){this.index=0,this.ending=!1,this.updated=!1,this.key=e,this.index=n,this.startEvent=new a(i,this.index),this.currentEvent=new a(i,this.index),this.targetElm=this.startEvent.event.target,!this.closestDragElm&&this.targetElm.classList.contains("mt-draggable")&&(this.closestDragElm=this.targetElm),!this.closestScaleElm&&this.targetElm.classList.contains("mt-scaleable")&&(this.closestScaleElm=this.targetElm);for(var s=this.targetElm.parentElement;null!=s;)!this.closestDragElm&&s.classList.contains("mt-draggable")&&(this.closestDragElm=s),!this.closestScaleElm&&s.classList.contains("mt-scaleable")&&(this.closestScaleElm=s),s=s.parentElement;this.targetElm&&!this.targetElm.dataset.uniqueId&&(this.targetElm.dataset.uniqueId=t.Manager.generateGuid()),this.closestDragElm&&!this.closestDragElm.dataset.uniqueId&&(this.closestDragElm.dataset.uniqueId=t.Manager.generateGuid()),this.closestScaleElm&&!this.closestScaleElm.dataset.uniqueId&&(this.closestScaleElm.dataset.uniqueId=t.Manager.generateGuid())}return e.prototype.update=function(t){this.previousEvent=this.currentEvent,this.currentEvent=new a(t,this.index),this.updated=!0},e}(),i=function(){function t(t,e){this.pageX=t,this.pageY=e}return t}();t.Position=i;var a=function(){function t(t,e){this.index=0,this.time=performance.now(),this.event=t,this.index=e,this.position=this.getEventPostion()}return t.prototype.getEventPostion=function(){if(event instanceof TouchEvent){if(event.touches.item(this.index))return new i(event.touches.item(this.index).pageX,event.touches.item(this.index).pageY);if(event.changedTouches.item(this.index))return new i(event.changedTouches.item(this.index).pageX,event.changedTouches.item(this.index).pageY)}else if(event instanceof MouseEvent)return new i(event.pageX,event.pageY)},t}()}(Multitouch||(Multitouch={})),function(t){var e=new Multitouch.Manager(t);e.init()}(document);