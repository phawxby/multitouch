var Multitouch;!function(t){var e=function(){function t(t){var e=this;this.document=t,this.interactions={},this.setupDragHandler=function(){e.document.addEventListener("mt-drag",function(t){var n=t.target;if(n.matches(".mt-draggable")){var i=e.closestParent(n,".mt-draggable-target")||n,a=e.getStyleValues(i);a.isPositioned||(i.style.position="relative"),i.style.top=a.top+t.detail.y+"px",i.style.left=a.left+t.detail.x+"px"}})},this.setupScaleHandler=function(){e.document.addEventListener("mt-scale",function(t){var n=t.target;if(n.matches(".mt-scaleable")){var i=e.closestParent(n,".mt-scaleable-target")||n,a=e.getStyleValues(i);a.isPositioned||(i.style.position="relative"),i.style.top=a.top+t.detail.y+"px",i.style.left=a.left+t.detail.x+"px",i.style.width=a.width+t.detail.w+"px",i.style.height=a.height+t.detail.h+"px"}})},this.getStyleValues=function(t){var e;return{isPositioned:!(!t.style.position&&!(e=window.getComputedStyle(t)).position),top:parseInt(t.style.top||(e||(e=window.getComputedStyle(t))).top)||0,left:parseInt(t.style.left||(e||(e=window.getComputedStyle(t))).left)||0,width:parseInt(t.style.width||(e||(e=window.getComputedStyle(t))).width)||0,height:parseInt(t.style.height||(e||(e=window.getComputedStyle(t))).height)||0}},this.closestParent=function(t,e){for(var n=t,i=!1;!(i=n.matches(e))&&null!==n.parentElement;)n=n.parentElement;return i?n:void 0},t.addEventListener("touchstart",function(t){e.handleInteraction(t)}),t.addEventListener("touchend",function(t){e.handleInteraction(t)}),t.addEventListener("touchcancel",function(t){e.handleInteraction(t)}),t.addEventListener("touchmove",function(t){e.handleInteraction(t)}),t.addEventListener("mousedown",function(t){e.handleInteraction(t)}),t.addEventListener("mouseup",function(t){e.handleInteraction(t)}),t.addEventListener("mousemove",function(t){e.handleInteraction(t)}),t.addEventListener("click",function(t){e.handleInteraction(t)}),this.setupDragHandler(),this.setupScaleHandler()}return t.generateGuid=function(){var t=performance.now(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return e},t.prototype.handleInteraction=function(t){if(t instanceof TouchEvent)for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],a="touch-"+i.identifier,s=t.target;s.dataset.touch=(!0).toString();var r=this.interactions[a];t.type.indexOf("start")>=0?this.interactions[a]=new n(a,i.identifier,t):t.type.indexOf("cancel")>=0?this.interactions[a]=null:r&&r.update(t),r&&(r.ending=t.type.indexOf("end")>0,this.interactions[a]=r)}else if(t instanceof MouseEvent){var o="mouse",s=t.target;if(t.type.indexOf("click")>=0)return s.dataset.passclick===(!0).toString()?void(s.dataset.passclick=(!1).toString()):(t.stopImmediatePropagation(),void t.preventDefault());if(s.dataset.touch===(!0).toString())return t.type.indexOf("up")>=0&&(s.dataset.touch=(!1).toString()),t.stopImmediatePropagation(),void t.preventDefault();var r=this.interactions[o];t.type.indexOf("down")>=0?this.interactions[o]=new n(o,0,t):r&&r.update(t),r&&(r.ending=t.type.indexOf("up")>=0,this.interactions[o]=r)}this.coalesceInteractions()},t.prototype.coalesceInteractions=function(){var t=this.interactions,e=Object.keys(t).map(function(e){return t[e]});if(console.log(e),e.length>0)for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.updated){var s=!1;if(!s&&a.closestScaleElm){for(var r=void 0,o=0,l=e;o<l.length;o++){var c=l[o];if(a!=c&&c.closestScaleElm==a.closestScaleElm){r=c;break}}if(r){var d=a.previousEvent?a.previousEvent.position:a.currentEvent.position,u=a.currentEvent.position,h=r.previousEvent?r.previousEvent.position:r.currentEvent.position,p=r.currentEvent.position;if(d&&u&&h&&p){var g=u.pageX-d.pageX,v=u.pageY-d.pageY,f=p.pageX-h.pageX,m=p.pageY-h.pageY,E=Math.ceil(u.pageX<p.pageX?g:f),x=Math.ceil(u.pageY<p.pageY?v:m),y=Math.ceil((u.pageX<p.pageX?f:g)+-1*E),w=Math.ceil((u.pageY<p.pageY?m:v)+-1*x),S=new CustomEvent("mt-scale");S.initCustomEvent("mt-scale",!0,!0,{x:E,y:x,w:y,h:w}),a.targetElm.dispatchEvent(S)}s=!0}}if(!s&&a.closestDragElm&&a.currentEvent&&!a.ending){if(a.previousEvent){var I=a.previousEvent.position,M=a.currentEvent.position;if(I&&M){var X=Math.ceil(M.pageX-I.pageX),Y=Math.ceil(M.pageY-I.pageY),S=new CustomEvent("mt-drag");S.initCustomEvent("mt-drag",!0,!0,{x:X,y:Y}),a.targetElm.dispatchEvent(S)}}s=!0}if(!s&&a.targetElm&&a.startEvent&&a.currentEvent&&a.ending&&a.currentEvent.time-a.startEvent.time<300){var I=a.startEvent.position,M=a.currentEvent.position;if(I&&M){var L=M.pageX-I.pageX;L=0>L?-1*L:0;var D=M.pageY-I.pageY;D=0>D?-1*D:0,30>L&&30>D&&(s=!0,a.targetElm.dataset.passclick=(!0).toString(),a.targetElm.click())}}s&&(a.currentEvent.event.preventDefault(),a.currentEvent.event.stopImmediatePropagation(),this.interactions[a.key].updated=!1),a.ending&&delete this.interactions[a.key]}}},t}();t.Manager=e;var n=function(){function e(e,n,a){this.key=e,this.index=n,this.ending=!1,this.updated=!0,this.startEvent=new i(a,this.index),this.currentEvent=new i(a,this.index),this.targetElm=this.startEvent.event.target,!this.closestDragElm&&this.targetElm.classList.contains("mt-draggable")&&(this.closestDragElm=this.targetElm),!this.closestScaleElm&&this.targetElm.classList.contains("mt-scaleable")&&(this.closestScaleElm=this.targetElm);for(var s=this.targetElm.parentElement;null!=s;)!this.closestDragElm&&s.classList.contains("mt-draggable")&&(this.closestDragElm=s),!this.closestScaleElm&&s.classList.contains("mt-scaleable")&&(this.closestScaleElm=s),s=s.parentElement;this.targetElm&&!this.targetElm.dataset.uniqueId&&(this.targetElm.dataset.uniqueId=t.Manager.generateGuid()),this.closestDragElm&&!this.closestDragElm.dataset.uniqueId&&(this.closestDragElm.dataset.uniqueId=t.Manager.generateGuid()),this.closestScaleElm&&!this.closestScaleElm.dataset.uniqueId&&(this.closestScaleElm.dataset.uniqueId=t.Manager.generateGuid())}return e.prototype.update=function(t){this.previousEvent=this.currentEvent,this.currentEvent=new i(t,this.index),this.updated=!0},e}(),i=function(){function t(t,e){this.event=t,this.index=e,this.time=performance.now(),this.position=this.getEventPostion()}return t.prototype.getEventPostion=function(){if(event instanceof TouchEvent){for(var t=0;t<event.touches.length;t++){var e=event.touches[t];if(e.identifier==this.index)return{pageX:e.pageX,pageY:e.pageY}}for(var t=0;t<event.changedTouches.length;t++){var e=event.changedTouches[t];if(e.identifier==this.index)return{pageX:e.pageX,pageY:e.pageY}}}else if(event instanceof MouseEvent)return{pageX:event.pageX,pageY:event.pageY}},t}()}(Multitouch||(Multitouch={})),function(t){new Multitouch.Manager(t)}(document);