var Multitouch;!function(t){var e=function(){function t(e){var a=this;this.document=e,this.interactions={},this.handleInteraction=function(t){if(t instanceof TouchEvent)for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],r="touch-"+i.identifier,s=t.target;s.dataset.touch=(!0).toString();var o=a.interactions[r];t.type.indexOf("start")>=0?a.interactions[r]=new n(r,i.identifier,t):t.type.indexOf("cancel")>=0?a.interactions[r]=null:o&&o.update(t),o&&(o.ending=t.type.indexOf("end")>0,a.interactions[r]=o)}else if(t instanceof MouseEvent){var l="mouse",s=t.target;if(t.type.indexOf("click")>=0)return s.dataset.passclick===(!0).toString()?void(s.dataset.passclick=(!1).toString()):(t.stopImmediatePropagation(),void t.preventDefault());if(s.dataset.touch===(!0).toString())return t.type.indexOf("up")>=0&&(s.dataset.touch=(!1).toString()),t.stopImmediatePropagation(),void t.preventDefault();var o=a.interactions[l];t.type.indexOf("down")>=0?a.interactions[l]=new n(l,0,t):o&&o.update(t),o&&(o.ending=t.type.indexOf("up")>=0,a.interactions[l]=o)}a.coalesceInteractions()},this.coalesceInteractions=function(){var t=a.interactions,e=Object.keys(t).map(function(e){return t[e]});if(e.length>0)for(var n=0,i=e;n<i.length;n++){var r=i[n];if(r.updated){var s=Array();if(!s.length&&r.closestScaleElm){for(var o=void 0,l=0,c=e;l<c.length;l++){var g=c[l];if(r!=g&&g.closestScaleElm==r.closestScaleElm){o=g;break}}if(o){var u=(r.previousEvent?r.previousEvent.position:r.currentEvent.position,r.currentEvent.position),p=r.startEvent.position,d=(o.previousEvent?o.previousEvent.position:o.currentEvent.position,o.currentEvent.position),h=o.startEvent.position;if(p&&u&&h&&d){var f=Math.ceil(p.pageLeft<h.pageLeft?u.targetLeft-p.targetLeft:d.targetLeft-h.targetLeft),v=Math.ceil(p.pageTop<h.pageTop?u.targetTop-p.targetTop:d.targetTop-h.targetTop),m=Math.ceil(p.pageLeft>h.pageLeft?u.targetRight-p.targetRight:d.targetRight-h.targetRight),E=Math.ceil(p.pageTop>h.pageTop?u.targetBottom-p.targetBottom:d.targetBottom-h.targetBottom);m+=-1*f,E+=-1*v;var x=new CustomEvent("mt-scale");x.initCustomEvent("mt-scale",!0,!0,{x:f,y:v,w:m,h:E}),r.targetElm.dispatchEvent(x)}s.push(r),s.push(o)}}if(!s.length&&r.closestDragElm&&r.currentEvent&&!r.ending){if(r.previousEvent){var y=r.previousEvent.position,L=r.currentEvent.position,w=r.startEvent.position;if(y&&L){var S=Math.ceil(L.targetLeft-w.targetLeft),T=Math.ceil(L.targetTop-w.targetTop);console.log(L);var x=new CustomEvent("mt-drag");x.initCustomEvent("mt-drag",!0,!0,{x:S,y:T}),r.targetElm.dispatchEvent(x)}}s.push(r)}if(!s.length&&r.targetElm&&r.startEvent&&r.currentEvent&&r.ending&&r.currentEvent.time-r.startEvent.time<300){var y=r.startEvent.position,L=r.currentEvent.position;if(y&&L){var I=L.pageLeft-y.pageLeft;I=0>I?-1*I:0;var M=L.pageTop-y.pageTop;M=0>M?-1*M:0,30>I&&30>M&&(s.push(r),r.targetElm.dataset.passclick=(!0).toString(),r.targetElm.click())}}for(var D=0,P=s;D<P.length;D++){var k=P[D];k.currentEvent.event.preventDefault(),k.currentEvent.event.stopImmediatePropagation(),a.interactions[k.key].updated=!1}}r.ending&&delete a.interactions[r.key]}},this.setupDragHandler=function(){a.document.addEventListener("mt-drag",function(e){var n=e.target;if(n.matches(".mt-draggable")){var i=a.closestParent(n,".mt-draggable-target")||n,r=t.getStyleValues(i);r.isPositioned||(i.style.position="relative"),i.style.top=r.top+e.detail.y+"px",i.style.left=r.left+e.detail.x+"px"}})},this.setupScaleHandler=function(){a.document.addEventListener("mt-scale",function(e){var n=e.target;if(n.matches(".mt-scaleable")){var i=a.closestParent(n,".mt-scaleable-target")||n,r=t.getStyleValues(i);r.isPositioned||(i.style.position="relative"),i.style.top=r.top+e.detail.y+"px",i.style.left=r.left+e.detail.x+"px",i.style.width=r.width+e.detail.w+"px",i.style.height=r.height+e.detail.h+"px"}})},this.closestParent=function(t,e){for(var n=t,a=!1;!(a=n.matches(e))&&null!==n.parentElement;)n=n.parentElement;return a?n:void 0},e.addEventListener("touchstart",function(t){a.handleInteraction(t)}),e.addEventListener("touchend",function(t){a.handleInteraction(t)}),e.addEventListener("touchcancel",function(t){a.handleInteraction(t)}),e.addEventListener("touchmove",function(t){a.handleInteraction(t)}),e.addEventListener("mousedown",function(t){a.handleInteraction(t)}),e.addEventListener("mouseup",function(t){a.handleInteraction(t)}),e.addEventListener("mousemove",function(t){a.handleInteraction(t)}),e.addEventListener("click",function(t){a.handleInteraction(t)}),this.setupDragHandler(),this.setupScaleHandler()}return t.generateGuid=function(){var t=performance.now(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return e},t.getStyleValues=function(t){var e;return{isPositioned:!(!t.style.position&&!(e=window.getComputedStyle(t)).position),top:parseInt(t.style.top||(e||(e=window.getComputedStyle(t))).top)||0,left:parseInt(t.style.left||(e||(e=window.getComputedStyle(t))).left)||0,width:parseInt(t.style.width||(e||(e=window.getComputedStyle(t))).width)||0,height:parseInt(t.style.height||(e||(e=window.getComputedStyle(t))).height)||0}},t}();t.Manager=e;var n=function(){function e(e,n,i){this.key=e,this.index=n,this.ending=!1,this.updated=!0,this.startEvent=new a(i,this.index),this.targetElm=this.startEvent.event.target,this.currentEvent=new a(i,this.index,this.targetElm),!this.closestDragElm&&this.targetElm.classList.contains("mt-draggable")&&(this.closestDragElm=this.targetElm),!this.closestScaleElm&&this.targetElm.classList.contains("mt-scaleable")&&(this.closestScaleElm=this.targetElm);for(var r=this.targetElm.parentElement;null!=r;)!this.closestDragElm&&r.classList.contains("mt-draggable")&&(this.closestDragElm=r),!this.closestScaleElm&&r.classList.contains("mt-scaleable")&&(this.closestScaleElm=r),r=r.parentElement;this.targetElm&&!this.targetElm.dataset.uniqueId&&(this.targetElm.dataset.uniqueId=t.Manager.generateGuid()),this.closestDragElm&&!this.closestDragElm.dataset.uniqueId&&(this.closestDragElm.dataset.uniqueId=t.Manager.generateGuid()),this.closestScaleElm&&!this.closestScaleElm.dataset.uniqueId&&(this.closestScaleElm.dataset.uniqueId=t.Manager.generateGuid())}return e.prototype.update=function(t){this.previousEvent=this.currentEvent,this.currentEvent=new a(t,this.index,this.targetElm),this.updated=!0},e}(),a=function(){function t(t,e,n){void 0===n&&(n=null),this.event=t,this.identifier=e,this.time=performance.now(),this.position=this.getEventPostion(n)}return t.prototype.getEventPostion=function(t){if(event instanceof TouchEvent)for(var n=0,a=[event.touches,event.changedTouches];n<a.length;n++)for(var i=a[n],r=0;r<i.length;r++){var s=i[r];if(s.identifier==this.identifier){for(var o=t||s.target,l=e.getStyleValues(o),c=0,g=0,u=o;null!=u;)isNaN(u.offsetLeft)||(c+=u.offsetLeft),isNaN(u.offsetTop)||(g+=u.offsetTop),u=u.offsetParent;return{pageLeft:s.pageX,pageTop:s.pageY,target:o,targetLeft:s.pageX-c,targetTop:s.pageY-g,targetRight:s.pageX-(l.width+c),targetBottom:s.pageY-(l.height+g)}}}else if(event instanceof MouseEvent){for(var o=t||event.target,l=e.getStyleValues(o),c=0,g=0,u=o;null!=u;)isNaN(u.offsetLeft)||(c+=u.offsetLeft),isNaN(u.offsetTop)||(g+=u.offsetTop),u=u.offsetParent;return{pageLeft:event.pageX,pageTop:event.pageY,target:o,targetLeft:event.pageX-c,targetTop:event.pageY-g,targetRight:event.pageX-(l.width+c),targetBottom:event.pageY-(l.height+g)}}},t}()}(Multitouch||(Multitouch={})),function(t){new Multitouch.Manager(t)}(document);