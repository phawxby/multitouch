var Multitouch;!function(t){var e=function(){function t(e){var n=this;this.document=e,this.interactions={},this.setupDragHandler=function(){n.document.addEventListener("mt-drag",function(e){var a=e.target;if(a.matches(".mt-draggable")){var i=n.closestParent(a,".mt-draggable-target")||a,s=t.getStyleValues(i);s.isPositioned||(i.style.position="relative"),i.style.top=s.top+e.detail.y+"px",i.style.left=s.left+e.detail.x+"px"}})},this.setupScaleHandler=function(){n.document.addEventListener("mt-scale",function(e){var a=e.target;if(a.matches(".mt-scaleable")){var i=n.closestParent(a,".mt-scaleable-target")||a,s=t.getStyleValues(i);s.isPositioned||(i.style.position="relative"),i.style.top=s.top+e.detail.y+"px",i.style.left=s.left+e.detail.x+"px",i.style.width=s.width+e.detail.w+"px",i.style.height=s.height+e.detail.h+"px"}})},this.closestParent=function(t,e){for(var n=t,a=!1;!(a=n.matches(e))&&null!==n.parentElement;)n=n.parentElement;return a?n:void 0},e.addEventListener("touchstart",function(t){n.handleInteraction(t)}),e.addEventListener("touchend",function(t){n.handleInteraction(t)}),e.addEventListener("touchcancel",function(t){n.handleInteraction(t)}),e.addEventListener("touchmove",function(t){n.handleInteraction(t)}),e.addEventListener("mousedown",function(t){n.handleInteraction(t)}),e.addEventListener("mouseup",function(t){n.handleInteraction(t)}),e.addEventListener("mousemove",function(t){n.handleInteraction(t)}),e.addEventListener("click",function(t){n.handleInteraction(t)}),this.setupDragHandler(),this.setupScaleHandler()}return t.generateGuid=function(){var t=performance.now(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:3&n|8).toString(16)});return e},t.prototype.handleInteraction=function(t){if(t instanceof TouchEvent)for(var e=0;e<t.changedTouches.length;e++){var a=t.changedTouches[e],i="touch-"+a.identifier,s=t.target;s.dataset.touch=(!0).toString();var r=this.interactions[i];t.type.indexOf("start")>=0?this.interactions[i]=new n(i,a.identifier,t):t.type.indexOf("cancel")>=0?this.interactions[i]=null:r&&r.update(t),r&&(r.ending=t.type.indexOf("end")>0,this.interactions[i]=r)}else if(t instanceof MouseEvent){var o="mouse",s=t.target;if(t.type.indexOf("click")>=0)return s.dataset.passclick===(!0).toString()?void(s.dataset.passclick=(!1).toString()):(t.stopImmediatePropagation(),void t.preventDefault());if(s.dataset.touch===(!0).toString())return t.type.indexOf("up")>=0&&(s.dataset.touch=(!1).toString()),t.stopImmediatePropagation(),void t.preventDefault();var r=this.interactions[o];t.type.indexOf("down")>=0?this.interactions[o]=new n(o,0,t):r&&r.update(t),r&&(r.ending=t.type.indexOf("up")>=0,this.interactions[o]=r)}this.coalesceInteractions()},t.prototype.coalesceInteractions=function(){var t=this.interactions,e=Object.keys(t).map(function(e){return t[e]});if(e.length>0)for(var n=0,a=e;n<a.length;n++){var i=a[n];if(i.updated){var s=Array();if(!s.length&&i.closestScaleElm){for(var r=void 0,o=0,l=e;o<l.length;o++){var c=l[o];if(i!=c&&c.closestScaleElm==i.closestScaleElm){r=c;break}}if(r){var g=(i.previousEvent?i.previousEvent.position:i.currentEvent.position,i.currentEvent.position),h=i.startEvent.position,p=(r.previousEvent?r.previousEvent.position:r.currentEvent.position,r.currentEvent.position),u=r.startEvent.position;if(h&&g&&u&&p){var d=Math.ceil(h.pageLeft<u.pageLeft?g.targetLeft-h.targetLeft:p.targetLeft-u.targetLeft),v=Math.ceil(h.pageTop<u.pageTop?g.targetTop-h.targetTop:p.targetTop-u.targetTop),f=Math.ceil((h.pageLeft>u.pageLeft?g.targetRight-h.targetRight:p.targetRight-u.targetRight)+-1*d),m=Math.ceil((h.pageTop>u.pageTop?g.targetBottom-h.targetBottom:p.targetBottom-u.targetBottom)+-1*v),E=new CustomEvent("mt-scale");E.initCustomEvent("mt-scale",!0,!0,{x:d,y:v,w:f,h:m}),i.targetElm.dispatchEvent(E)}s.push(i),s.push(r)}}if(!s.length&&i.closestDragElm&&i.currentEvent&&!i.ending){if(i.previousEvent){var x=i.previousEvent.position,y=i.currentEvent.position,L=i.startEvent.position;if(x&&y){var w=Math.ceil(y.targetLeft-L.targetLeft),S=Math.ceil(y.targetTop-L.targetTop),E=new CustomEvent("mt-drag");E.initCustomEvent("mt-drag",!0,!0,{x:w,y:S}),i.targetElm.dispatchEvent(E)}}s.push(i)}if(!s.length&&i.targetElm&&i.startEvent&&i.currentEvent&&i.ending&&i.currentEvent.time-i.startEvent.time<300){var x=i.startEvent.position,y=i.currentEvent.position;if(x&&y){var T=y.pageLeft-x.pageLeft;T=0>T?-1*T:0;var I=y.pageTop-x.pageTop;I=0>I?-1*I:0,30>T&&30>I&&(s.push(i),i.targetElm.dataset.passclick=(!0).toString(),i.targetElm.click())}}for(var M=0,D=s;M<D.length;M++){var k=D[M];k.currentEvent.event.preventDefault(),k.currentEvent.event.stopImmediatePropagation(),this.interactions[k.key].updated=!1}}i.ending&&delete this.interactions[i.key]}},t.getStyleValues=function(t){var e;return{isPositioned:!(!t.style.position&&!(e=window.getComputedStyle(t)).position),top:parseInt(t.style.top||(e||(e=window.getComputedStyle(t))).top)||0,left:parseInt(t.style.left||(e||(e=window.getComputedStyle(t))).left)||0,width:parseInt(t.style.width||(e||(e=window.getComputedStyle(t))).width)||0,height:parseInt(t.style.height||(e||(e=window.getComputedStyle(t))).height)||0}},t}();t.Manager=e;var n=function(){function e(e,n,i){this.key=e,this.index=n,this.ending=!1,this.updated=!0,this.startEvent=new a(i,this.index),this.targetElm=this.startEvent.event.target,this.currentEvent=new a(i,this.index,this.targetElm),!this.closestDragElm&&this.targetElm.classList.contains("mt-draggable")&&(this.closestDragElm=this.targetElm),!this.closestScaleElm&&this.targetElm.classList.contains("mt-scaleable")&&(this.closestScaleElm=this.targetElm);for(var s=this.targetElm.parentElement;null!=s;)!this.closestDragElm&&s.classList.contains("mt-draggable")&&(this.closestDragElm=s),!this.closestScaleElm&&s.classList.contains("mt-scaleable")&&(this.closestScaleElm=s),s=s.parentElement;this.targetElm&&!this.targetElm.dataset.uniqueId&&(this.targetElm.dataset.uniqueId=t.Manager.generateGuid()),this.closestDragElm&&!this.closestDragElm.dataset.uniqueId&&(this.closestDragElm.dataset.uniqueId=t.Manager.generateGuid()),this.closestScaleElm&&!this.closestScaleElm.dataset.uniqueId&&(this.closestScaleElm.dataset.uniqueId=t.Manager.generateGuid())}return e.prototype.update=function(t){this.previousEvent=this.currentEvent,this.currentEvent=new a(t,this.index,this.targetElm),this.updated=!0},e}(),a=function(){function t(t,e,n){void 0===n&&(n=null),this.event=t,this.identifier=e,this.time=performance.now(),this.position=this.getEventPostion(n)}return t.prototype.getEventPostion=function(t){if(event instanceof TouchEvent)for(var n=0,a=[event.touches,event.changedTouches];n<a.length;n++)for(var i=a[n],s=0;s<i.length;s++){var r=i[s];if(r.identifier==this.identifier){var o=t||r.target,l=e.getStyleValues(o);return{pageLeft:r.pageX,pageTop:r.pageY,target:o,targetLeft:r.pageX-o.offsetLeft,targetTop:r.pageY-o.offsetTop,targetRight:r.pageX-(l.width-o.offsetLeft),targetBottom:r.pageY-(l.height-o.offsetTop)}}}else if(event instanceof MouseEvent){var o=t||event.target,l=e.getStyleValues(o);return{pageLeft:event.pageX,pageTop:event.pageY,target:o,targetLeft:event.pageX-o.offsetLeft,targetTop:event.pageY-o.offsetTop,targetRight:event.pageX-(l.width-o.offsetLeft),targetBottom:event.pageY-(l.height-o.offsetTop)}}},t}()}(Multitouch||(Multitouch={})),function(t){new Multitouch.Manager(t)}(document);